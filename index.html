<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê∑</text></svg>">
  <title>Pig Head üê∑</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/notiflix@3.2.6/dist/notiflix-aio-3.2.6.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #ffb6c1, #ff69b4);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    h1 {
      margin-top: 10px;
      font-size: 2.5rem;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      animation: bounceIn 0.6s ease;
    }
    @keyframes bounceIn {
      0% { transform: scale(0.5); opacity: 0; }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    .container {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 24px;
      width: 100%;
      max-width: 480px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.3);
    }
    input {
      font-size: 1rem;
      border: 2px solid rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.9);
      color: #333;
      outline: none;
      border-radius: 12px;
      padding: 12px 16px;
      width: 60%;
      transition: 0.3s;
    }
    input:focus {
      border-color: #ff4fa3;
      box-shadow: 0 0 10px rgba(255,79,163,0.5);
    }
    button {
      font-size: 1rem;
      font-weight: 600;
      border: none;
      outline: none;
      border-radius: 12px;
      padding: 12px 18px;
      background: linear-gradient(135deg, #ff4fa3, #ff2c8b);
      color: white;
      margin: 5px;
      transition: all 0.3s ease;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255,79,163,0.4);
    }
    button:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 20px rgba(255,79,163,0.5);
    }
    button:active {
      transform: scale(0.98);
    }
    
    /* Bot√µes de pontos */
    .points-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin: 15px 0;
    }
    .points-grid button {
      font-size: 1.1rem;
      padding: 14px 8px;
    }
    
    /* Bot√£o desfazer */
    .btn-undo {
      background: linear-gradient(135deg, #ff9800, #f57c00) !important;
      box-shadow: 0 4px 15px rgba(255,152,0,0.4) !important;
    }
    
    /* Bot√µes de a√ß√£o secund√°ria */
    .actions-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin: 15px 0;
    }
    .btn-danger {
      background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
      box-shadow: 0 4px 15px rgba(231,76,60,0.4) !important;
    }
    .btn-success {
      background: linear-gradient(135deg, #27ae60, #1e8449) !important;
      box-shadow: 0 4px 15px rgba(39,174,96,0.4) !important;
    }
    .btn-warning {
      background: linear-gradient(135deg, #f39c12, #d68910) !important;
      box-shadow: 0 4px 15px rgba(243,156,18,0.4) !important;
    }
    
    /* Scoreboard melhorado */
    .player-list {
      margin: 15px 0;
      text-align: left;
    }
    .player {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      margin: 8px 0;
      background: rgba(255,255,255,0.15);
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .player.active {
      background: rgba(255,255,255,0.35);
      transform: scale(1.02);
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
      border-left: 4px solid #fff;
    }
    .player .name {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .player .points {
      font-size: 1.3rem;
      font-weight: 700;
    }
    
    /* Barra de progresso */
    .progress-container {
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      height: 12px;
      margin: 10px 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #fff, #ffe4ec);
      border-radius: 10px;
      transition: width 0.3s ease;
    }
    
    /* Info da rodada */
    .round-info {
      background: rgba(255,255,255,0.2);
      border-radius: 16px;
      padding: 16px;
      margin: 15px 0;
    }
    .round-info h2 {
      margin: 0 0 10px 0;
      font-size: 1.4rem;
    }
    .round-score {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 10px 0;
    }
    .total-possivel {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    .winner {
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
      padding: 16px;
      border-radius: 16px;
      margin-top: 15px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.4); }
      50% { box-shadow: 0 0 20px 10px rgba(255,255,255,0.2); }
    }
    
    footer {
      margin-top: auto;
      padding: 15px;
      font-size: 0.9rem;
      opacity: 0.8;
      text-align: center;
    }
    footer a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }
    footer a:hover {
      text-decoration: underline;
    }

    #instructions, #scoreTable {
      display: none;
      background: rgba(255,255,255,0.2);
      border-radius: 15px;
      padding: 15px;
      margin-top: 15px;
      text-align: left;
      font-size: 0.95rem;
      line-height: 1.5;
      animation: fadeIn 0.4s ease;
    }
    #instructions h3, #scoreTable h3 {
      text-align: center;
      margin-bottom: 10px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      color: #fff;
      font-size: 0.9rem;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.3);
      text-align: left;
    }
    th {
      background: rgba(255,255,255,0.3);
    }

    @media (max-width: 480px) {
      h1 { font-size: 1.8rem; }
      .container { padding: 16px; }
      button { padding: 10px 12px; font-size: 0.9rem; }
      .points-grid { grid-template-columns: repeat(4, 1fr); }
      .actions-grid { grid-template-columns: 1fr; }
      .round-score { font-size: 2rem; }
    }
    
    /* Lista de jogadores no setup */
    .setup-player {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.2);
      padding: 10px 14px;
      border-radius: 10px;
      margin: 6px 0;
    }
    .setup-player .player-name {
      font-weight: 600;
    }
    .setup-player .player-actions {
      display: flex;
      gap: 5px;
    }
    .setup-player .player-actions button {
      padding: 6px 10px;
      font-size: 0.85rem;
      margin: 0;
    }
    .btn-edit {
      background: linear-gradient(135deg, #3498db, #2980b9) !important;
      box-shadow: 0 3px 10px rgba(52,152,219,0.4) !important;
    }
    .btn-remove {
      background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
      box-shadow: 0 3px 10px rgba(231,76,60,0.4) !important;
    }
  </style>
</head>
<body>
  <h1>üê∑ Pig Head</h1>
  <div class="container">
    <div id="setup">
      <input type="text" id="playerName" placeholder="Nome do jogador" onkeypress="if(event.key==='Enter')addPlayer()" />
      <button onclick="addPlayer()">‚ûï Adicionar</button>
      <div class="player-list" id="playerList"></div>
      <button onclick="startGame()" id="startBtn" class="btn-success">üéÆ Iniciar Jogo</button>
    </div>

    <div id="game" style="display:none;">
      <div class="round-info">
        <h2 id="turnInfo"></h2>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <div class="round-score">üéØ <span id="roundScore">0</span></div>
        <div class="total-possivel">Total: <span id="totalPossivel">0</span> / 100</div>
      </div>
      
      <div class="points-grid">
        <button onclick="addPoints(1)">+1</button>
        <button onclick="addPoints(5)">+5</button>
        <button onclick="addPoints(10)">+10</button>
        <button onclick="addPoints(15)">+15</button>
        <button onclick="addPoints(20)">+20</button>
        <button onclick="addPoints(40)">+40</button>
        <button onclick="addPoints(60)">+60</button>
        <button onclick="undoLastAction()" class="btn-undo">‚Ü©Ô∏è</button>
      </div>

      <div class="actions-grid">
        <button onclick="hold()" class="btn-success">‚úÖ Parar</button>
        <button onclick="resetRound()" class="btn-warning">üîÑ Zerar rodada</button>
        <button onclick="resetPlayerPoints()" class="btn-danger">‚ùå Zerar jogador</button>
        <button onclick="playerWO()" class="btn-danger">üö´ Remover</button>
      </div>
      
      <div class="actions-grid">
        <button onclick="resetGame()">üîÅ Zerar tudo</button>
        <button onclick="restartGame()">üÜï Novo jogo</button>
      </div>
      
      <div class="player-list" id="scoreboard"></div>
      <div class="winner" id="winnerMsg"></div>
    </div>

    <button onclick="toggleInstructions()" style="margin-top: 15px;">üìò Ver regras</button>
    <div id="instructions">
      <h3>Regras Oficiais do Jogo Pig</h3>
      <p><strong>Objetivo:</strong> Ser o primeiro jogador a alcan√ßar <b>100 pontos</b>.</p>
      <ul>
        <li>Os jogadores se revezam em turnos.</li>
        <li>Durante o turno, o jogador soma pontos ou pode ‚Äúparar‚Äù.</li>
        <li>Se parar, os pontos da rodada s√£o adicionados ao total.</li>
        <li>O primeiro a chegar a 100 vence!</li>
      </ul>
      <button onclick="toggleScoreTable()">Ver pontua√ß√£o</button>

      <div id="scoreTable">
        <h3>Tabela Oficial de Pontua√ß√£o</h3>
        <table>
          <tr><th>Posi√ß√£o</th><th>Pontos</th></tr>
          <tr><td>Pig Out</td><td>0</td></tr>
          <tr><td>Sider</td><td>0</td></tr>
          <tr><td>Razorback</td><td>5</td></tr>
          <tr><td>Trotter</td><td>5</td></tr>
          <tr><td>Snouter</td><td>10</td></tr>
          <tr><td>Leaning Jowler</td><td>15</td></tr>
          <tr><td>Double Razorback</td><td>20</td></tr>
          <tr><td>Double Trotter</td><td>20</td></tr>
          <tr><td>Double Snouter</td><td>40</td></tr>
          <tr><td>Double Leaning Jowler</td><td>60</td></tr>
        </table>
      </div>
    </div>
  </div>

  <footer>
    Desenvolvido por <a href="https://www.linkedin.com/in/wallace-barbosa-1a7488328/" target="_blank">Barbosasw</a>
  </footer>

  <script>
    Notiflix.Confirm.init({
      okButtonBackground: '#ff4fa3',
      okButtonColor: '#fff',
      cancelButtonBackground: '#ffb6c1',
      cancelButtonColor: '#fff',
      titleColor: '#ff4fa3',
      backgroundColor: '#fff4fa'
    });
    
    let players = [];
    let currentPlayer = 0;
    let roundScore = 0;
    let gameActive = false;
    let stateHistory = []; // Pilha de estados para desfazer m√∫ltiplas vezes

    window.onload = () => {
      const saved = localStorage.getItem("pighead_game");
      if (saved) {
        const data = JSON.parse(saved);
        players = data.players;
        currentPlayer = data.currentPlayer;
        roundScore = data.roundScore;
        gameActive = data.gameActive;
        document.getElementById("setup").style.display = "none";
        document.getElementById("game").style.display = "block";
        updateUI();
      }
    };

    function saveGame() {
      localStorage.setItem("pighead_game", JSON.stringify({ players, currentPlayer, roundScore, gameActive }));
    }

    function addPlayer() {
      const nameInput = document.getElementById("playerName");
      const name = nameInput.value.trim();
      if (name) {
        players.push({ name, total: 0 });
        nameInput.value = "";
        renderPlayerList();
      }
    }

    function renderPlayerList() {
      document.getElementById("playerList").innerHTML = players
        .map((p, i) => `
          <div class="setup-player">
            <span class="player-name">${i + 1}. ${p.name}</span>
            <div class="player-actions">
              <button class="btn-edit" onclick="editPlayer(${i})">‚úèÔ∏è</button>
              <button class="btn-remove" onclick="removePlayer(${i})">‚úï</button>
            </div>
          </div>
        `)
        .join("");
    }
    
    function editPlayer(index) {
      Notiflix.Confirm.prompt(
        "‚úèÔ∏è Editar Jogador",
        "Digite o novo nome:",
        players[index].name,
        "Salvar",
        "Cancelar",
        (newName) => {
          if (newName && newName.trim()) {
            players[index].name = newName.trim();
            renderPlayerList();
            Notiflix.Notify.success("Nome atualizado!");
          }
        },
        () => {},
        {
          okButtonBackground: '#ff4fa3',
          cancelButtonBackground: '#ffb6c1',
          titleColor: '#ff4fa3',
          backgroundColor: '#fff4fa'
        }
      );
    }
    
    function removePlayer(index) {
      const removed = players.splice(index, 1)[0];
      renderPlayerList();
      Notiflix.Notify.warning(`${removed.name} removido!`);
    }

    function startGame() {
      if (players.length < 2)
        return Notiflix.Notify.failure("Adicione pelo menos 2 jogadores!");
      gameActive = true;
      document.getElementById("setup").style.display = "none";
      document.getElementById("game").style.display = "block";
      Notiflix.Notify.success("Jogo iniciado");
      updateUI();
    }

    function addPoints(points) {
      if (!gameActive) return;
      
      // Salvar estado antes de modificar (empilha no hist√≥rico)
      stateHistory.push({
        players: JSON.parse(JSON.stringify(players)),
        currentPlayer: currentPlayer,
        roundScore: roundScore,
        gameActive: gameActive,
        winnerMsg: document.getElementById("winnerMsg").innerHTML
      });
      
      roundScore += points;

      // Verificar se acumulado + rodada >= 100 => vencedor imediato
      const totalPossivel = players[currentPlayer].total + roundScore;
      if (totalPossivel >= 100) {
        players[currentPlayer].total = totalPossivel;
        document.getElementById("winnerMsg").innerHTML =
          `üéâ <strong>${players[currentPlayer].name}</strong> venceu!<br>` +
          `Acumulado: ${players[currentPlayer].total - roundScore} + Rodada: ${roundScore} = <strong>${totalPossivel} pontos!</strong>`;
        gameActive = false;
        stateHistory = []; // Limpar hist√≥rico de undo
        
        Notiflix.Confirm.show(
          "üéâ Fim de jogo!",
          `${players[currentPlayer].name} venceu com ${totalPossivel} pontos!`,
          "Novo Jogo",
          "Nova Rodada",
          // Bot√£o 1: Novo Jogo (volta √† tela de setup)
          () => {
            players = [];
            currentPlayer = 0;
            roundScore = 0;
            gameActive = false;
            stateHistory = [];
            document.getElementById("game").style.display = "none";
            document.getElementById("setup").style.display = "block";
            document.getElementById("playerList").innerHTML = "";
            document.getElementById("winnerMsg").textContent = "";
            localStorage.removeItem("pighead_game");
            Notiflix.Notify.success("Adicione os jogadores para um novo jogo!");
          },
          // Bot√£o 2: Nova Rodada (mant√©m jogadores, zera pontos)
          () => {
            players.forEach(p => p.total = 0);
            roundScore = 0;
            currentPlayer = 0;
            gameActive = true;
            stateHistory = [];
            document.getElementById("winnerMsg").textContent = "";
            Notiflix.Notify.success("Nova rodada com os mesmos jogadores!");
            updateUI();
          }
        );
      }

      updateUI();
    }

    function hold() {
      if (!gameActive) return;
      players[currentPlayer].total += roundScore;

      if (players[currentPlayer].total >= 100) {
        document.getElementById("winnerMsg").textContent =
          `${players[currentPlayer].name} venceu com ${players[currentPlayer].total} pontos!`;
        gameActive = false;
        Notiflix.Report.success("Fim de jogo", "Temos um vencedor!", "Ok");
      } else {
        roundScore = 0;
        nextPlayer();
      }
      updateUI();
    }

    function resetRound() {
      roundScore = 0;
      nextPlayer();
      Notiflix.Notify.info("Rodada zerada");
      updateUI();
    }

    function resetPlayerPoints() {
      Notiflix.Confirm.show(
        "Zerar jogador",
        `Deseja zerar os pontos de ${players[currentPlayer].name}?`,
        "Sim",
        "Cancelar",
        () => {
          players[currentPlayer].total = 0;
          roundScore = 0;
          Notiflix.Notify.warning(`${players[currentPlayer].name} teve seus pontos zerados`);
          nextPlayer();
          updateUI();
        }
      );
    }

    function resetGame() {
      Notiflix.Confirm.show(
        "Zerar tudo",
        "Tem certeza que deseja zerar todos os pontos?",
        "Sim",
        "Cancelar",
        () => {
          players.forEach(p => p.total = 0);
          roundScore = 0;
          currentPlayer = 0;
          gameActive = true;
          document.getElementById("winnerMsg").textContent = "";
          Notiflix.Notify.warning("Todos os pontos foram zerados");
          updateUI();
        }
      );
    }

    function restartGame() {
      Notiflix.Confirm.show(
        "Reiniciar jogo",
        "Deseja come√ßar um novo jogo do zero (inclui jogadores)?",
        "Sim",
        "Cancelar",
        () => {
          players = [];
          currentPlayer = 0;
          roundScore = 0;
          gameActive = false;
          document.getElementById("game").style.display = "none";
          document.getElementById("setup").style.display = "block";
          document.getElementById("playerList").innerHTML = "";
          document.getElementById("winnerMsg").textContent = "";
          localStorage.removeItem("pighead_game");
          Notiflix.Notify.success("Jogo reiniciado");
        }
      );
    }

    function nextPlayer() {
      currentPlayer = (currentPlayer + 1) % players.length;
      roundScore = 0;
    }

    function updateUI() {
      // Verifica√ß√£o de seguran√ßa
      if (!players.length || !players[currentPlayer]) return;
      
      document.getElementById("turnInfo").textContent =
        `üé≤ Vez de: ${players[currentPlayer].name}`;
      document.getElementById("roundScore").textContent = roundScore;
      
      // Mostrar total poss√≠vel (acumulado + rodada)
      const totalAtual = players[currentPlayer].total + roundScore;
      document.getElementById("totalPossivel").textContent = totalAtual;
      
      // Atualizar barra de progresso
      const progressPercent = Math.min(totalAtual, 100);
      document.getElementById("progressBar").style.width = `${progressPercent}%`;

      document.getElementById("scoreboard").innerHTML = players
        .map((p, i) => `
          <div class="player ${i === currentPlayer ? "active" : ""}">
            <span class="name">${i === currentPlayer ? "üëâ" : ""} ${p.name}</span>
            <span class="points">${p.total}</span>
          </div>
        `)
        .join("");

      saveGame();
    }

    function toggleInstructions() {
      const instr = document.getElementById("instructions");
      instr.style.display = instr.style.display === "none" ? "block" : "none";
    }

    function toggleScoreTable() {
      const table = document.getElementById("scoreTable");
      table.style.display = table.style.display === "none" ? "block" : "none";
    }

    /* ===========================================================
       üö® FUN√á√ÉO NOVA ‚Äî WO (REMOVE JOGADOR DA RODADA)
    ============================================================ */
    function playerWO() {
      const player = players[currentPlayer];

      Notiflix.Confirm.show(
        "WO - Remover Jogador",
        `Confirmar WO para ${player.name}?`,
        "Sim",
        "Cancelar",
        () => {
          players.splice(currentPlayer, 1); // remove jogador

          // se ficou s√≥ 1, este √© o vencedor
          if (players.length === 1) {
            const winner = players[0];
            document.getElementById("winnerMsg").innerHTML =
              `üèÜ <strong>${winner.name}</strong> venceu!<br>Todos os outros sa√≠ram por WO.`;
            gameActive = false;
            stateHistory = [];
            
            // Delay para garantir que o popup anterior feche antes de abrir o novo
            setTimeout(() => {
              Notiflix.Confirm.show(
                "üèÜ Temos um vencedor!",
                `${winner.name} venceu! Todos os outros sa√≠ram por WO.`,
                "Novo Jogo",
                "Nova Rodada",
                // Bot√£o 1: Novo Jogo (volta √† tela de setup)
                () => {
                  players = [];
                  currentPlayer = 0;
                  roundScore = 0;
                  gameActive = false;
                  stateHistory = [];
                  document.getElementById("game").style.display = "none";
                  document.getElementById("setup").style.display = "block";
                  document.getElementById("playerList").innerHTML = "";
                  document.getElementById("winnerMsg").textContent = "";
                  localStorage.removeItem("pighead_game");
                  Notiflix.Notify.success("Adicione os jogadores para um novo jogo!");
                },
                // Bot√£o 2: Nova Rodada (mant√©m jogadores, zera pontos)
                () => {
                  players.forEach(p => p.total = 0);
                  roundScore = 0;
                  currentPlayer = 0;
                  gameActive = true;
                  stateHistory = [];
                  document.getElementById("winnerMsg").textContent = "";
                  Notiflix.Notify.success("Nova rodada com os mesmos jogadores!");
                  updateUI();
                }
              );
            }, 300);
            return;
          }

          // ajustar √≠ndice do jogador atual
          if (currentPlayer >= players.length) {
            currentPlayer = 0;
          }

          roundScore = 0;
          Notiflix.Notify.warning(`${player.name} foi removido por WO`);
          updateUI();
        }
      );
    }

    function undoLastAction() {
      if (stateHistory.length === 0) {
        Notiflix.Notify.warning("Nada para desfazer!");
        return;
      }

      const lastState = stateHistory.pop(); // Pega o √∫ltimo estado da pilha
      players = lastState.players;
      currentPlayer = lastState.currentPlayer;
      roundScore = lastState.roundScore;
      gameActive = lastState.gameActive;
      document.getElementById("winnerMsg").innerHTML = lastState.winnerMsg;

      Notiflix.Notify.info(`Desfeito! (${stateHistory.length} a√ß√µes restantes)`);
      updateUI();
    }

  </script>
</body>
</html>
